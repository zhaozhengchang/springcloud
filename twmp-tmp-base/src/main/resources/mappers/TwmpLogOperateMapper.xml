<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ceiec.twmp.tmp.mapper.TwmpLogOperateMapper" >
  <resultMap id="BaseResultMap" type="com.ceiec.twmp.tmp.entity.TwmpLogOperate" >
    <!--
      WARNING - @mbg.generated
    -->
    <id column="operate_id" property="operateId" jdbcType="BIGINT" />
    <result column="operate_name" property="operateName" jdbcType="VARCHAR" />
    <result column="operate_type" property="operateType" jdbcType="TINYINT" />
    <result column="operate_object_type" property="operateObjectType" jdbcType="TINYINT" />
    <result column="operate_time" property="operateTime" jdbcType="TIMESTAMP" />
    <result column="operator" property="operator" jdbcType="VARCHAR" />
    <result column="operator_id" property="operatorId" jdbcType="BIGINT" />
    <result column="comment" property="comment" jdbcType="VARCHAR" />
    <result column="department_id" property="departmentId" jdbcType="BIGINT" />
    <result column="department_name" property="departmentName" jdbcType="VARCHAR" />
  </resultMap>

  <resultMap id="OperateLogResultMap" type="com.ceiec.twmp.tmp.vo.systemlog.operatelog.result.OperateLogQueryResultVO" >
    <id column="operate_id" property="operateId" jdbcType="BIGINT" />
    <result column="operate_name" property="operateName" jdbcType="VARCHAR" />
    <result column="operate_type" property="operateType" jdbcType="TINYINT" />
    <result column="operate_object_type" property="operateObjectType" jdbcType="TINYINT" />
    <result column="operate_time" property="operateTimeDate" jdbcType="TIMESTAMP" />
    <result column="operator" property="operator" jdbcType="VARCHAR" />
  </resultMap>


  <select id="getOperateLogListByPage" parameterType="com.ceiec.twmp.tmp.vo.systemlog.operatelog.query.OperateLogQueryVO" resultMap="OperateLogResultMap">
    select log.operate_id operate_id, log.operate_name operate_name, log.operate_object_type operate_object_type,
    log.operate_time operate_time, log.operate_type operate_type, log.operator operator
    from twmp_log_operate log
    <trim prefix="where" prefixOverrides="and" >
      <if test="operator != null and operator != ''" >
        and log.operator like concat('%', #{operator}, '%')
      </if>
      <if test="operateName != null and operateName != ''">
        and log.operate_name like concat('%', #{operateName}, '%')
      </if>
      <if test="operateType != null and operateType != '' and operateType != 0">
        and log.operate_type = #{operateType}
      </if>
      <if test=" operateObjectType != null " >
        and log.operate_object_type = #{operateObjectType}
      </if>
      <if test=" startTimeDate != null " >
        and unix_timestamp(log.operate_time) &gt;= unix_timestamp(#{startTimeDate})
      </if>
      <if test=" endTimeDate != null" >
        and unix_timestamp(log.operate_time) &lt;= unix_timestamp(#{endTimeDate})
      </if>
      <if test=" departmentIds != null and departmentIds.size != 0"  >
        and log.department_id in
        <foreach collection="departmentIds" item="id" index="index" separator="," open="(" close=")">
          #{id}
        </foreach>
      </if>
    </trim>
  </select>

  <!-- 总量统计 -->
  <select id="countLogTotal" parameterType="com.ceiec.twmp.tmp.vo.systemlog.operatelog.query.OperateLogQueryVO"
          resultType="int">
    select count(operate_id) from twmp_log_operate log
    <trim prefix="where" prefixOverrides="and" >
      <if test="operator != null and operator != ''" >
        and log.operator like concat('%', #{operator}, '%')
      </if>
      <if test="operateName != null and operateName != ''">
        and log.operate_name like concat('%', #{operateName}, '%')
      </if>
      <if test="operateType != null and operateType != '' and operateType != 0">
        and log.operate_type = #{operateType}
      </if>
      <if test=" operateObjectType != null " >
        and log.operate_object_type = #{operateObjectType}
      </if>
      <if test=" startTimeDate != null " >
        and unix_timestamp(log.operate_time) &gt;= unix_timestamp(#{startTimeDate})
      </if>
      <if test=" endTimeDate != null" >
        and unix_timestamp(log.operate_time) &lt;= unix_timestamp(#{endTimeDate})
      </if>
      <if test=" departmentIds != null and departmentIds.size != 0"  >
        and log.department_id in
        <foreach collection="departmentIds" item="id" index="index" separator="," open="(" close=")">
          #{id}
        </foreach>
      </if>
    </trim>
  </select>

  <select id="getOperateLogList" parameterType="com.ceiec.twmp.tmp.vo.systemlog.operatelog.query.OperateLogQueryVO" resultMap="OperateLogResultMap">
    select operate_id, operate_name,  operate_object_type, operate_time, operate_type, operator
    from twmp_log_operate log
    <trim prefix="where" prefixOverrides="and" >
      <if test="operator != null and operator != ''" >
        and log.operator like concat('%', #{operator}, '%')
      </if>
      <if test="operateName != null and operateName != ''">
        and log.operate_name like concat('%', #{operateName}, '%')
      </if>
      <if test="operateType != null and operateType != '' and operateType != 0">
        and log.operate_type = #{operateType}
      </if>
      <if test=" operateObjectType != null " >
        and log.operate_object_type = #{operateObjectType}
      </if>
      <if test=" startTimeDate != null " >
        and unix_timestamp(log.operate_time) &gt;= unix_timestamp(#{startTimeDate})
      </if>
      <if test=" endTimeDate != null" >
        and unix_timestamp(log.operate_time) &lt;= unix_timestamp(#{endTimeDate})
      </if>
      <if test=" departmentIds != null and departmentIds.size() != 0"  >
        and log.department_id in
        <foreach collection="departmentIds" item="id" index="index" separator="," open="(" close=")">
          #{id}
        </foreach>
      </if>
    </trim>
    order by log.operate_time desc
  </select>
</mapper>